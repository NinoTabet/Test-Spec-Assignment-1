<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Library</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
<body class="bg-dark vw-100 vh-100 p-3">
    <header class="  w-100 d-flex justify-content-center align-items-center h-25">
        <h1 class="text-light"><u>THE LIBRARY</u></h1>
    </header>
    <section class="  h-75 mt-lg-3 container-fluid">
        <div class="row h-100">
            <!-- Column for the form -->
            <div class="col-12 col-md-4   rounded-2 h-50 d-flex justify-content-center align-items-center mb-md-0">
                <form class="text-center w-100" id="book-form">
                    <div class="form-group">
                        <label for="formMode">Select Mode</label>
                        <select class="form-select" id="formMode">
                            <option value="search">Search</option>
                            <option value="create">Create</option>
                            <option value="delete">Delete</option>
                        </select>
                    </div>
                    <div id="searchMode" class="form-mode mt-3">
                        <div class="form-group mb-3">
                            <label for="searchTitle">Book Title</label>
                            <input type="text" class="form-control" id="searchTitle" placeholder="Enter book title">
                        </div>
                        <button type="submit" class="btn btn-primary">Search</button>
                    </div>
                    <div id="createMode" class="form-mode d-none mt-3">
                        <div class="form-group mb-3">
                            <label for="createTitle">Title</label>
                            <input type="text" class="form-control" id="createTitle" placeholder="Enter book title">
                        </div>
                        <div class="form-group mb-3">
                            <label for="createAuthor">Author</label>
                            <input type="text" class="form-control" id="createAuthor" placeholder="Enter author name">
                        </div>
                        <button type="submit" class="btn btn-success">Create</button>
                    </div>
                    <div id="deleteMode" class="form-mode d-none mt-3">
                        <div class="form-group mb-3">
                            <label for="deleteTitle">Title</label>
                            <input type="text" class="form-control" id="deleteTitle" placeholder="Enter book title">
                        </div>
                        <div class="form-group mb-3">
                            <label for="deleteAuthor">Author</label>
                            <input type="text" class="form-control" id="deleteAuthor" placeholder="Enter author name">
                        </div>
                        <button type="submit" class="btn btn-danger">Delete</button>
                    </div>
                </form>
            </div>
            <div class="col-12 col-md-8 overflow-auto d-flex justify-content-center align-items-center" style="max-height: 100%;">
                <div id="card-container" class="d-flex flex-wrap justify-content-around   overflow-auto h-100">
                    <!-- Cards will be dynamically inserted here -->
                </div>
            </div>
        </div>
    </section>    
    
    <script>
        // event listener to toggle form modes based on user selection
        document.getElementById('formMode').addEventListener('change', function() {
            const selectedMode = this.value; // gets the selected mode (search, create, delete)
            
            // hides all form mode sections
            document.querySelectorAll('.form-mode').forEach(mode => {
                mode.classList.add('d-none');
            });
            
            // shows the selected form mode section
            document.getElementById(`${selectedMode}Mode`).classList.remove('d-none');
        });
    
        // event listener for form submission
        document.getElementById('book-form').addEventListener('submit', async function(event) {
            event.preventDefault(); // prevents the default form submission behavior
    
            const formMode = document.getElementById('formMode').value; // gets the current form mode
            let url = ''; // initializes URL variable
            let method = ''; // initializes HTTP method variable
            let data = {}; // initializes data object for request body
    
            // determines URL, HTTP method, and data based on the selected form mode
            switch (formMode) {
                case 'search':
                    url = `http://localhost:3000/search?title=${encodeURIComponent(document.getElementById('searchTitle').value)}`;
                    method = 'GET';
                    break;
                case 'create':
                    url = 'http://localhost:3000/create';
                    method = 'POST';
                    data = {
                        title: document.getElementById('createTitle').value,
                        author: document.getElementById('createAuthor').value
                    };
                    break;
                case 'delete':
                    url = 'http://localhost:3000/delete';
                    method = 'DELETE';
                    data = {
                        title: document.getElementById('deleteTitle').value,
                        author: document.getElementById('deleteAuthor').value
                    };
                    break;
                default:
                    console.error('Invalid form mode selected'); // logs error if the mode is invalid
                    return;
            }
    
            try {
                // sends API request using fetch
                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: method === 'GET' ? undefined : JSON.stringify(data) // sends data if method is not GET
                });
    
                if (response.ok) {
                    const result = await response.json(); // parses JSON response
                    
                    // selects the card container element
                    const cardContainer = document.getElementById('card-container');
                    cardContainer.innerHTML = ''; // clears existing cards
    
                    if (Array.isArray(result)) {
                        // creates and appends a card for each book in the result
                        result.forEach(book => {
                            const card = document.createElement('div');
                            card.className = 'card mb-3'; // bootstrap card class
                            card.style.width = '18rem'; // sets card width
                            card.style.height = '5rem';
                            card.innerHTML = `
                                <div class="card-body">
                                    <h5 class="card-title">${book.title}</h5>
                                    <h6 class="card-subtitle mb-2 text-muted">${book.author}</h6>
                                </div>
                            `;
                            cardContainer.appendChild(card);
                        });
                    } else if(result){
                        alert(result.message);
                    }
                    else{
                        alert('No books found'); // alerts if no books are found
                    }
                } else {
                    alert('Request failed with status: ' + response.status); // alerts if request fails
                }
            } catch (error) {
                console.error('Error:', error); // logs error if request fails
                alert('An error occurred'); // alerts on error
            }
        });
    </script>
        
</body>
</html>